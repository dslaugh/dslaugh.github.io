<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tournament Countdown Timer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --glow-color: #3b82f6;
      /* Blue-500, default */
    }

    body {
      font-family: 'Orbitron', sans-serif;
      background-color: #111827;
      /* Gray-900 */
      color: #f9fafb;
      /* Gray-50 */
    }

    .timer-display {
      display: grid;
      grid-template-columns: 5fr 1fr 5fr;
      font-size: 5rem;
      line-height: 1;
      letter-spacing: 0.1em;
      transition: text-shadow 0.3s ease;
      /* Reduced glow effect */
      text-shadow:
        0 0 5px var(--glow-color),
        0 0 15px var(--glow-color);
    }

    @media (min-width: 640px) {
      .timer-display {
        font-size: 7rem;
      }
    }

    .blinds-display {
      font-size: 2rem;
      letter-spacing: 0.05em;
      color: var(--glow-color);
      text-shadow: 0 0 8px var(--glow-color);
      transition: all 0.3s ease;
    }

    @media (min-width: 640px) {
      .blinds-display {
        font-size: 2.5rem;
      }
    }

    .neon-button {
      transition: all 0.3s ease;
      border: 2px solid var(--glow-color);
      color: var(--glow-color);
      background-color: transparent;
      text-shadow: 0 0 2px var(--glow-color);
      box-shadow: inset 0 0 8px var(--glow-color), 0 0 8px var(--glow-color);
    }

    .neon-button:hover,
    .neon-button:focus {
      color: #111827;
      background-color: var(--glow-color);
      box-shadow: inset 0 0 10px var(--glow-color), 0 0 20px var(--glow-color), 0 0 30px var(--glow-color);
      text-shadow: none;
    }

    .neon-button:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      background-color: transparent !important;
      color: var(--glow-color) !important;
      text-shadow: 0 0 2px var(--glow-color) !important;
      box-shadow: inset 0 0 8px var(--glow-color), 0 0 8px var(--glow-color) !important;
    }

    input,
    select {
      background-color: #1f2937;
      border: 2px solid #374151;
      color: #f9fafb;
      transition: all 0.3s ease;
      -moz-appearance: textfield;
    }

    input:focus,
    select:focus {
      outline: none;
      border-color: var(--glow-color);
      box-shadow: 0 0 10px var(--glow-color);
    }

    .color-swatch {
      width: 28px;
      height: 28px;
      border-radius: 9999px;
      cursor: pointer;
      border: 2px solid #4b5563;
      transition: all 0.2s ease;
    }

    .color-swatch:hover {
      transform: scale(1.15);
    }

    .color-swatch.active {
      border-color: #f9fafb;
      box-shadow: 0 0 8px currentColor;
    }

    #schedule-editor,
    #color-editor {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.7s ease-in-out;
    }
  </style>
</head>

<body class="flex items-center justify-center min-h-screen">

  <div class="w-full max-w-3xl mx-auto p-4 text-center">
    <h1 class="text-3xl sm:text-5xl font-bold mb-4 text-white" style="text-shadow: 0 0 10px var(--glow-color);">
      Tournament Timer</h1>

    <!-- Main Displays -->
    <div class="my-6">
      <div id="round-display" class="text-xl sm:text-2xl text-gray-300 mb-2">Round 1</div>
      <div id="timer-display" class="timer-display font-bold">
        <div id="timer-display-minutes" style="justify-self: end;">00</div>
        <div>:</div>
        <div id="timer-display-seconds" style="justify-self: start;">00</div>
      </div>
      <div id="blinds-display" class="blinds-display font-bold mt-2">Blinds: 25 / 50</div>
    </div>

    <!-- Main Controls -->
    <div class="flex justify-center items-center space-x-2 sm:space-x-4">
      <button id="start-btn" class="neon-button font-bold py-3 px-6 rounded-lg text-lg">Start</button>
      <button id="stop-btn" class="neon-button font-bold py-3 px-6 rounded-lg text-lg">Stop</button>
      <button id="reset-btn" class="neon-button font-bold py-3 px-6 rounded-lg text-lg">Reset Round</button>
    </div>

    <!-- Round Navigation Controls -->
    <div class="flex justify-center items-center space-x-2 sm:space-x-4 mt-4 mb-8">
      <button id="prev-round-btn" class="neon-button font-bold py-2 px-5 rounded-lg text-base">Prev Round</button>
      <button id="next-round-btn" class="neon-button font-bold py-2 px-5 rounded-lg text-base">Next Round</button>
    </div>

    <!-- Schedule Section Toggle -->
    <button id="toggle-schedule-btn" class="text-gray-400 mb-4">Show Schedule ▼</button>

    <!-- Schedule Editor (hidden by default) -->
    <div id="schedule-editor">
      <div class="bg-gray-800 bg-opacity-50 p-4 rounded-lg">
        <h2 class="text-2xl font-bold mb-4">Tournament Schedule</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
          <select id="schedule-select" class="p-2 rounded-lg"></select>
          <button id="load-schedule-btn" class="neon-button p-2 rounded-lg">Load Selected Schedule</button>
        </div>
        <div id="schedule-list" class="pr-2">
          <!-- Schedule rounds will be populated here -->
        </div>
        <button id="add-round-btn" class="neon-button mt-4 py-2 px-4 rounded-lg hidden">Add Round</button>
      </div>
    </div>

    <!-- Color Section Toggle -->
    <button id="toggle-color-btn" class="text-gray-400 mt-4">Show Colors ▼</button>

    <!-- Color Editor (hidden by default) -->
    <div id="color-editor">
      <div id="color-controls" class="mt-4">
        <label class="block text-sm font-medium text-gray-400 mb-3">Glow Color</label>
        <div class="flex justify-center items-center space-x-3"></div>
      </div>
    </div>

    <!-- Hidden inputs for legacy one-off timer -->
    <div id="setup-container" class="hidden">
      <input type="number" id="minutes" value="15">
      <input type="number" id="seconds" value="0">
    </div>
  </div>

  <script>
    // DOM Elements
    const timerDisplay = document.getElementById('timer-display');
    const timerDisplayMinutes = document.getElementById('timer-display-minutes');
    const timerDisplaySeconds = document.getElementById('timer-display-seconds');
    const roundDisplay = document.getElementById('round-display');
    const blindsDisplay = document.getElementById('blinds-display');
    const startBtn = document.getElementById('start-btn');
    const stopBtn = document.getElementById('stop-btn');
    const resetBtn = document.getElementById('reset-btn');
    const prevRoundBtn = document.getElementById('prev-round-btn');
    const nextRoundBtn = document.getElementById('next-round-btn');

    const toggleScheduleBtn = document.getElementById('toggle-schedule-btn');
    const scheduleEditor = document.getElementById('schedule-editor');
    const scheduleSelect = document.getElementById('schedule-select');
    const loadScheduleBtn = document.getElementById('load-schedule-btn');
    const scheduleList = document.getElementById('schedule-list');
    const addRoundBtn = document.getElementById('add-round-btn');

    const toggleColorBtn = document.getElementById('toggle-color-btn');
    const colorEditor = document.getElementById('color-editor');
    const colorControlsContainer = document.getElementById('color-controls').querySelector('div');

    const minutesInput = document.getElementById('minutes');
    const secondsInput = document.getElementById('seconds');

    // State
    let totalSeconds = 0;
    let timerInterval = null;
    let isRunning = false;
    let currentRoundIndex = 0;
    let activeSchedule = [];

    const synth = new Tone.Synth({oscillator: {type: 'sine'}, envelope: {attack: 0.005, decay: 0.1, sustain: 0.3, release: 1}}).toDestination();

    // --- Schedules Data ---
    const schedules = {
      standard: [
        {minutes: 15, blinds: "25/50"}, {minutes: 15, blinds: "50/100"},
        {minutes: 12, blinds: "100/200"}, {minutes: 12, blinds: "150/300"},
        {minutes: 12, blinds: "200/400"}, {minutes: 12, blinds: "300/600"},
        {minutes: 10, blinds: "500/1000"}, {minutes: 10, blinds: "800/1600"},
        {minutes: 10, blinds: "1000/2000"}, {minutes: 10, blinds: "1500/3000"},
        {minutes: 8, blinds: "2000/4000"}, {minutes: 8, blinds: "3000/6000"},
        {minutes: 8, blinds: "4000/8000"}, {minutes: 8, blinds: "6000/12000"},
        {minutes: 5, blinds: "8000/16000"}, {minutes: 5, blinds: "10000/20000"},
        {minutes: 5, blinds: "15000/30000"}, {minutes: 5, blinds: "20000/40000"},
        {minutes: 5, blinds: "20000/40000"}, {minutes: 5, blinds: "20000/40000"},
      ],

      turbo: [
        {minutes: 10, blinds: "25/50"}, {minutes: 10, blinds: "50/100"},
        {minutes: 10, blinds: "100/200"}, {minutes: 8, blinds: "200/400"},
        {minutes: 8, blinds: "300/600"}, {minutes: 8, blinds: "500/1000"},
        {minutes: 5, blinds: "800/1600"}, {minutes: 5, blinds: "1000/2000"},
        {minutes: 5, blinds: "1500/3000"}, {minutes: 5, blinds: "2000/4000"},
        {minutes: 5, blinds: "3000/6000"}, {minutes: 5, blinds: "4000/8000"},
        {minutes: 3, blinds: "6000/12000"}, {minutes: 3, blinds: "8000/16000"},
        {minutes: 3, blinds: "10000/20000"}, {minutes: 3, blinds: "15000/30000"},
        {minutes: 3, blinds: "20000/40000"}, {minutes: 3, blinds: "20000/40000"},
        {minutes: 3, blinds: "20000/40000"}, {minutes: 3, blinds: "20000/40000"},
      ],
      custom: [
        {minutes: 15, blinds: "25/50"}, {minutes: 15, blinds: "50/100"},
      ],
      test: [
        {minutes: 3 / 60, blinds: "25/50"}, {minutes: 12 / 60, blinds: "50/100"}
      ]
    };

    // --- Core Timer & Round Logic ---
    function updateDisplay() {
      const displayMinutes = Math.floor(totalSeconds / 60);
      const displaySeconds = totalSeconds % 60;
      timerDisplayMinutes.textContent = String(displayMinutes).padStart(2, '0');
      timerDisplaySeconds.textContent = String(displaySeconds).padStart(2, '0');
    }

    function updateNavButtons() {
      prevRoundBtn.disabled = currentRoundIndex === 0;
      nextRoundBtn.disabled = currentRoundIndex >= activeSchedule.length - 1;
    }

    function loadRound(roundIndex) {
      if (!activeSchedule || roundIndex < 0 || roundIndex >= activeSchedule.length) {
        if (roundIndex >= activeSchedule.length) {
          stopTimer();
          roundDisplay.textContent = "Tournament Over";
          blindsDisplay.textContent = "Congratulations!";
          timerDisplay.innerHTML = "<div>&nbsp;</div><div>GG</div><div>&nbsp;</div>";
        }
        return false;
      }
      const roundData = activeSchedule[roundIndex];
      minutesInput.value = roundData.minutes;
      secondsInput.value = 0;
      totalSeconds = roundData.minutes * 60;

      roundDisplay.textContent = `Round ${roundIndex + 1}`;
      blindsDisplay.textContent = `Blinds: ${roundData.blinds}`;
      updateDisplay();
      updateNavButtons();
      return true;
    }

    function goToPrevRound() {
      if (currentRoundIndex > 0) {
        stopTimer();
        currentRoundIndex--;
        loadRound(currentRoundIndex);
      }
    }

    function goToNextRound() {
      if (currentRoundIndex < activeSchedule.length - 1) {
        stopTimer();
        currentRoundIndex++;
        loadRound(currentRoundIndex);
      }
    }

    function startTimer() {
      if (isRunning || totalSeconds <= 0) return;
      Tone.start();
      isRunning = true;
      [loadScheduleBtn, scheduleSelect, startBtn, prevRoundBtn, nextRoundBtn].forEach(el => el.disabled = true);

      timerInterval = setInterval(() => {
        totalSeconds--;
        updateDisplay();
        if (totalSeconds <= 0) {
          playBeepsAndAdvance();
        }
      }, 1000);
    }

    function stopTimer() {
      clearInterval(timerInterval);
      isRunning = false;
      [loadScheduleBtn, scheduleSelect, startBtn].forEach(el => el.disabled = false);
      updateNavButtons(); // Re-enable nav buttons if applicable
    }

    function resetTimer() {
      stopTimer();
      loadRound(currentRoundIndex);
    }

    function playBeepsAndAdvance() {
      clearInterval(timerInterval);
      isRunning = false;
      const now = Tone.now();
      // synth.triggerAttackRelease('C5', '8n', now);
      // synth.triggerAttackRelease('C5', '8n', now + 0.3);
      // synth.triggerAttackRelease('C5', '8n', now + 0.6);
      // synth.triggerAttackRelease('G5', '4n', now + 0.9);

      // synth.triggerAttackRelease('C5', '4n', now);
      // synth.triggerAttackRelease('C5', '8n', now + 0.5);
      // synth.triggerAttackRelease('C5', '8n', now + 1.0);
      // synth.triggerAttackRelease('G5', '2n', now + 1.5);

      // synth.triggerAttackRelease('C5', '1n', now);
      // synth.triggerAttackRelease('C6', '4n', now + 0.5);
      // synth.triggerAttackRelease('C5', '8n', now + 1.0);
      // synth.triggerAttackRelease('F5', '2n', now + 1.5);

      // synth.triggerAttackRelease('C5', 1, now);
      // synth.triggerAttackRelease('C5', 1, now + 1.2);
      // synth.triggerAttackRelease('C5', 1, now + 2.2);
      // synth.triggerAttackRelease('C5', 1, now + 3.2);
      // synth.triggerAttackRelease('C5', 1, now + 4.2);


      // synth.triggerAttackRelease('C5', '8n', now);
      // synth.triggerAttackRelease('C5', '8n', now + 0.5);
      // synth.triggerAttackRelease('C5', '8n', now + 1.0);
      // synth.triggerAttackRelease('C5', '8n', now + 1.5);
      // synth.triggerAttackRelease('C6', '1n', now + 2.0);

      synth.triggerAttackRelease('C5', 0.25, now);
      synth.triggerAttackRelease('C5', 0.25, now + 0.5);
      synth.triggerAttackRelease('C5', 0.25, now + 1.0);
      synth.triggerAttackRelease('C5', 0.25, now + 1.5);
      synth.triggerAttackRelease('G5', 2.0, now + 2.0);

      // synth.triggerAttackRelease('G6', 0.25, now + 1.5);
      // synth.triggerAttackRelease('C6', 0.25, now + 1.75);
      // synth.triggerAttackRelease('G6', 0.25, now + 2.0);
      // synth.triggerAttackRelease('C6', 0.25, now + 2.25);
      // synth.triggerAttackRelease('G6', 0.25, now + 2.5);
      // synth.triggerAttackRelease('C6', 0.25, now + 2.75);
      // synth.triggerAttackRelease('G6', 0.25, now + 3.0);
      // synth.triggerAttackRelease('C6', 0.25, now + 3.25);
      // synth.triggerAttackRelease('G6', 0.25, now + 3.5);
      // synth.triggerAttackRelease('C6', 0.25, now + 3.75);

      // synth.triggerAttackRelease('G5', 0.25, now);
      // synth.triggerAttackRelease('C5', 0.5, now + 0.25);
      // synth.triggerAttackRelease('G5', 0.25, now + 1.25);
      // synth.triggerAttackRelease('C5', 0.5, now + 1.5);
      // synth.triggerAttackRelease('G5', 0.25, now + 2);
      // synth.triggerAttackRelease('C5', 0.5, now + 2.25);
      // synth.triggerAttackRelease('G5', 0.25, now + 3.25);
      // synth.triggerAttackRelease('C5', 0.5, now + 3.5);
      // synth.triggerAttackRelease('G5', 0.25, now + 4);
      // synth.triggerAttackRelease('C5', 0.5, now + 4.25);
      // synth.triggerAttackRelease('G5', 0.25, now + 5.25);
      // synth.triggerAttackRelease('C5', 0.5, now + 5.5);
      // synth.triggerAttackRelease('G5', 0.25, now + 6);
      // synth.triggerAttackRelease('C5', 0.5, now + 6.25);
      // synth.triggerAttackRelease('G5', 0.25, now + 7.25);
      // synth.triggerAttackRelease('C5', 0.5, now + 7.5);

      // Iron man (ish)
      // synth.triggerAttackRelease('C4', 0.50, now);
      // synth.triggerAttackRelease('D#4', 0.50, now + 0.5);
      // synth.triggerAttackRelease('D#4', 0.50, now + 1.0);
      // synth.triggerAttackRelease('F4', 0.50, now + 1.5);
      // synth.triggerAttackRelease('F4', 0.50, now + 2.0);
      // synth.triggerAttackRelease('G#4', 0.25, now + 2.5);
      // synth.triggerAttackRelease('G4', 0.25, now + 2.75);
      // synth.triggerAttackRelease('G#4', 0.25, now + 3.0);
      // synth.triggerAttackRelease('G4', 0.25, now + 3.25);
      // synth.triggerAttackRelease('G#4', 0.25, now + 3.5);
      // synth.triggerAttackRelease('G4', 0.25, now + 3.75);
      // synth.triggerAttackRelease('F4', 0.50, now + 4.0);
      // synth.triggerAttackRelease('D#4', 0.50, now + 4.5);
      // synth.triggerAttackRelease('F4', 0.50, now + 5.0);
      // synth.triggerAttackRelease('F4', 0.50, now + 5.5);

      setTimeout(() => {
        currentRoundIndex++;
        if (loadRound(currentRoundIndex)) {
          startTimer();
        } else {
          // This handles the end of the tournament
          updateNavButtons();
        }
      }, 2500);
    }

    // --- UI Toggles ---
    function toggleScheduleEditor() {
      if (scheduleEditor.style.maxHeight) {
        scheduleEditor.style.maxHeight = null;
        toggleScheduleBtn.textContent = 'Show Schedule ▼';
      } else {
        scheduleEditor.style.maxHeight = scheduleEditor.scrollHeight + "px";
        toggleScheduleBtn.textContent = 'Hide Schedule ▲';
      }
    }

    function toggleColorEditor() {
      if (colorEditor.style.maxHeight) {
        colorEditor.style.maxHeight = null;
        toggleColorBtn.textContent = 'Show Colors ▼';
      } else {
        colorEditor.style.maxHeight = colorEditor.scrollHeight + "px";
        toggleColorBtn.textContent = 'Hide Colors ▲';
      }
    }

    // --- Schedule Editor Logic ---
    function populateScheduleSelect() {
      scheduleSelect.innerHTML = `
                <option value="standard">Standard (Preset)</option>
                <option value="turbo">Turbo (Preset)</option>
                <option value="custom">Custom</option>
                <option value="test">Test</option>
            `;
    }

    function renderScheduleList(scheduleName) {
      const schedule = schedules[scheduleName];
      scheduleList.innerHTML = '';
      const isCustom = scheduleName === 'custom';
      addRoundBtn.style.display = isCustom ? 'inline-block' : 'none';

      schedule.forEach((round, index) => {
        const roundEl = document.createElement('div');
        roundEl.className = 'grid grid-cols-3 bg-gray-900 px-4 py-2 rounded';
        roundEl.innerHTML = `
                    <div class="font-semibold text-left">Round ${index + 1}</div>
                    <div class="flex items-center gap-2">
                        ${isCustom ? `<input type="number" value="${round.minutes}" class="w-16 p-1 rounded text-center custom-min" data-index="${index}"> min` : `<span>${round.minutes} min</span>`}
                    </div>
                     <div class="flex items-center gap-2">
                        Blinds: ${isCustom ? `<input type="text" value="${round.blinds}" class="w-24 p-1 rounded text-center custom-blinds" data-index="${index}">` : `<span>${round.blinds}</span>`}
                        ${isCustom ? `<button class="text-red-500 hover:text-red-400 remove-round-btn" data-index="${index}">&times;</button>` : ''}
                    </div>
                `;
        scheduleList.appendChild(roundEl);
      });

      if (isCustom) {
        document.querySelectorAll('.custom-min, .custom-blinds').forEach(input => {
          input.addEventListener('change', updateCustomScheduleFromUI);
        });
        document.querySelectorAll('.remove-round-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            schedules.custom.splice(e.target.dataset.index, 1);
            renderScheduleList('custom');
          });
        });
      }
    }

    function updateCustomScheduleFromUI() {
      const minInputs = document.querySelectorAll('.custom-min');
      const blindInputs = document.querySelectorAll('.custom-blinds');
      const newCustomSchedule = [];
      minInputs.forEach((minInput, index) => {
        newCustomSchedule.push({
          minutes: parseInt(minInput.value) || 10,
          blinds: blindInputs[index].value || "0/0"
        });
      });
      schedules.custom = newCustomSchedule;
    }

    function loadSelectedSchedule() {
      stopTimer();
      if (scheduleSelect.value === 'custom') {
        updateCustomScheduleFromUI();
      }
      activeSchedule = JSON.parse(JSON.stringify(schedules[scheduleSelect.value]));
      currentRoundIndex = 0;
      loadRound(currentRoundIndex);
    }

    function addNewCustomRound() {
      schedules.custom.push({minutes: 10, blinds: "100/200"});
      renderScheduleList('custom');
    }

    // --- Color Control ---
    const colors = {
      violet: '#8b5cf6', blue: '#3b82f6', green: '#22c55e',
      yellow: '#facc15', orange: '#f97316', red: '#ef4444',
    };

    function changeColor(colorValue) {
      document.documentElement.style.setProperty('--glow-color', colorValue);
      colorControlsContainer.querySelectorAll('.color-swatch').forEach(swatch => {
        swatch.classList.toggle('active', swatch.dataset.color === colorValue);
        swatch.style.boxShadow = swatch.classList.contains('active') ? `0 0 10px ${colorValue}` : 'none';
      });
    }

    function createColorSwatches() {
      Object.entries(colors).forEach(([name, hex]) => {
        const swatch = document.createElement('button');
        swatch.className = 'color-swatch';
        swatch.style.backgroundColor = hex;
        swatch.style.color = hex;
        swatch.dataset.color = hex;
        swatch.setAttribute('aria-label', `Set color to ${name}`);
        swatch.addEventListener('click', () => changeColor(hex));
        colorControlsContainer.appendChild(swatch);
      });
    }

    // --- Initialization ---
    window.onload = () => {
      // Main Controls
      startBtn.addEventListener('click', startTimer);
      stopBtn.addEventListener('click', stopTimer);
      resetBtn.addEventListener('click', resetTimer);
      prevRoundBtn.addEventListener('click', goToPrevRound);
      nextRoundBtn.addEventListener('click', goToNextRound);

      // Schedule Controls
      populateScheduleSelect();
      scheduleSelect.addEventListener('change', (e) => renderScheduleList(e.target.value));
      loadScheduleBtn.addEventListener('click', loadSelectedSchedule);
      toggleScheduleBtn.addEventListener('click', toggleScheduleEditor);
      addRoundBtn.addEventListener('click', addNewCustomRound);

      // Color Controls
      toggleColorBtn.addEventListener('click', toggleColorEditor);
      createColorSwatches();
      changeColor(colors.blue);

      // Initial load
      loadSelectedSchedule();
      renderScheduleList(scheduleSelect.value);
    };
  </script>
</body>
</html>
